---
import Layout from '@layouts/Layout.astro';
import { getCategorizedWritings } from '@api/cleve';
import { marked } from 'marked';

export async function getStaticPaths() {
    const { notes } = await getCategorizedWritings();

    return notes.map(note => {
        // Extract slug from name (remove .md extension)
        const slug = note.name.replace(/\.md$/, '');

        return {
            params: {
                category: note.path,
                slug: slug
            },
            props: {
                note
            }
        };
    });
}

const { note } = Astro.props;
const { category } = Astro.params;

// Get title from original data or extract from markdown
const title = note._original?.title || note.name.replace(/\.md$/, '').replace(/-/g, ' ');

// Convert markdown to HTML
const htmlContent = marked(note.body);
---

<Layout title={title} description={note.frontmatter.description}>
    <article class="mx-auto max-w-3xl px-6 py-20">
        <!-- Breadcrumb -->
        <nav class="mb-8 text-sm text-neutral-600">
            <a href="/garden" class="hover:text-neutral-900">Garden</a>
            <span class="mx-2">/</span>
            <a href={`/garden#${category}`} class="hover:text-neutral-900">{category}</a>
            <span class="mx-2">/</span>
            <span class="text-neutral-900">{title}</span>
        </nav>

        <!-- Title -->
        <h1 class="mb-4 text-4xl font-bold">{title}</h1>

        <!-- Metadata -->
        <div class="mb-8 flex gap-4 text-sm text-neutral-600">
            <span>Created: {new Date(note.frontmatter.created).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</span>
            {note.frontmatter.edited && note.frontmatter.created !== note.frontmatter.edited && (
                <span>Updated: {new Date(note.frontmatter.edited).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</span>
            )}
        </div>

        <!-- Content -->
        <div class="markdown-content prose prose-lg prose-neutral max-w-none">
            <Fragment set:html={htmlContent} />
        </div>

        <!-- Back link -->
        <div class="mt-12 border-t border-neutral-200 pt-8">
            <a href="/garden" class="text-sm text-neutral-600 hover:text-neutral-900">‚Üê Back to Garden</a>
        </div>
    </article>
</Layout>

<style>
    .markdown-content {
        color: #292524;
    }
    .markdown-content h1,
    .markdown-content h2,
    .markdown-content h3,
    .markdown-content h4,
    .markdown-content h5,
    .markdown-content h6 {
        font-weight: 700;
        color: #1c1917;
        margin-top: 1.5em;
        margin-bottom: 0.5em;
    }
    .markdown-content a {
        color: #2563eb;
        text-decoration: underline;
    }
    .markdown-content a:hover {
        color: #1e40af;
    }
    .markdown-content code {
        background-color: #f5f5f4;
        padding: 0.125rem 0.375rem;
        border-radius: 0.25rem;
        font-family: ui-monospace, monospace;
        font-size: 0.875em;
    }
    .markdown-content pre {
        background-color: #1c1917;
        padding: 1rem;
        border-radius: 0.5rem;
        overflow-x: auto;
    }
    .markdown-content pre code {
        background-color: transparent;
        padding: 0;
        color: #f5f5f4;
    }
    .markdown-content blockquote {
        border-left: 4px solid #d4d4d8;
        padding-left: 1rem;
        font-style: italic;
        color: #44403c;
    }
    .markdown-content ul,
    .markdown-content ol {
        margin: 1rem 0;
        padding-left: 1.5rem;
    }
    .markdown-content li {
        margin: 0.5rem 0;
    }
    .markdown-content img {
        border-radius: 0.5rem;
        max-width: 100%;
        height: auto;
    }
    .markdown-content p {
        margin: 1rem 0;
    }
    .markdown-content hr {
        border-top: 1px solid #e7e5e4;
        margin: 2rem 0;
    }
</style>
